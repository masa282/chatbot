{% extends 'base.html' %}
{% load filter %}
{% load static %}

{% block title %}Chat Room{% endblock %}

{% block head %}
<!-- <link rel="stylesheet" href="{% static 'chat/css/room.css' %}"> -->
<style>
    #chat3 .form-control {
        border-color: transparent;
    }
    
    #chat3 .form-control:focus {
    border-color: transparent;
    box-shadow: inset 0px 0px 0px 1px transparent;
    }
    
    .badge-dot {
    border-radius: 50%;
    height: 10px;
    width: 10px;
    margin-left: 2.9rem;
    margin-top: -.75rem;
    }
</style>
{% endblock %}

{% block contents %}
<div style="display: flex; overflow: hidden; height:calc(100vh - 4.5rem);">
    <div style="display:flex;flex-direction:column; background-color:#454552; width:250px;">
        <button class="btn btn-primary" style="background-color:#454552;border-color:#EAEAEA;margin:5px;" onclick="location.href='{% url 'chat:new_room' lang %}'">New chat</button>
        <ul class="list-unstyled mb-0">
             <!-- friends list  -->
            {% for c, m in friends_log %}
            <li class="p-2 border-bottom">
                <a href="{% url 'chat:room' c.lang|drop_region_code c.chat_id %}" class="d-flex justify-content-between" style="text-decoration:none;">
                  <div class="d-flex flex-row">
                    <div>
                      <img src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-chat/ava2-bg.webp" alt="avatar" class="d-flex align-self-center me-3" width="60">
                      <span class="badge bg-warning badge-dot"></span>
                    </div>
                    <div class="pt-1">
                      <p class="fw-bold mb-0">{{ c.chat_id|sliceUUID }}</p>
                      <p class="small" style="color:white;margin-bottom:25px">{{ m.content|truncatechars:15 }}</p>
                    </div>
                  </div>
                  <div class="pt-1" style="position:relative">
                      <span class="badge rounded-pill float-end" style="background-color:#E85A70;">2</span>
                      <p class="small mb-1" style="color:#EAEAEA;position: absolute; bottom:0px;right:0px;">{{ m.created_at|timediff }}</p>
                  </div>
                </a>
            </li>            
            {% endfor %}
        </ul>
    </div>
    <div style="display:flex; position:relative; width:100%; flex-direction:column; background-color:white;">
        <div style="width: 100%; overflow-y: scroll; padding: 20px 0px 0px 20px;" id="chat-log-container">
            <!-- chat log -->
            {% for m in messages_log %}
                {% if request.user == m.sender %}
                <div class="d-flex flex-row justify-content-start">
                    <img src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-chat/ava6-bg.webp"
                    alt="avatar 1" style="width: 45px; height: 100%;">
                    <div>
                    <p class="small p-2 ms-3 mb-1 rounded-3" style="background-color: #EAEAEA;">{{ m.content }}</p>
                    <p class="small ms-3 mb-3 rounded-3 text-muted float-end">{{ m.created_at|timediff }}</p>
                    </div>
                </div>
                {% else %}
                <div class="d-flex flex-row justify-content-end">
                    <div>
                      <p class="small p-2 me-3 mb-1 text-white rounded-3" style="background-color:#4EA1D5;">{{ m.content }}</p>
                      <p class="small me-3 mb-3 rounded-3 text-muted">{{ m.created_at|timediff }}</p>
                    </div>
                    <img src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-chat/ava1-bg.webp"
                      alt="avatar 1" style="width: 45px; height: 100%;">
                </div>
                {% endif %}
            {% endfor %}
         
        </div>
        <div style="width: 100%; padding:0 10% 5% 10%; margin-top:auto;">
            <div style="background-color:#EAEAEA; border-radius:12px; padding:10px;display:flex; position:relative;" id="input-div">   
                <button id="speech-input-btn" style="background-color:#EAEAEA; border:none;padding:4px;">
                    <svg style="fill:#4EA1D5;width:3rem;height:3rem" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512" id="speech-icon"><!--! Font Awesome Pro 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M192 0C139 0 96 43 96 96V256c0 53 43 96 96 96s96-43 96-96V96c0-53-43-96-96-96zM64 216c0-13.3-10.7-24-24-24s-24 10.7-24 24v40c0 89.1 66.2 162.7 152 174.4V464H120c-13.3 0-24 10.7-24 24s10.7 24 24 24h72 72c13.3 0 24-10.7 24-24s-10.7-24-24-24H216V430.4c85.8-11.7 152-85.3 152-174.4V216c0-13.3-10.7-24-24-24s-24 10.7-24 24v40c0 70.7-57.3 128-128 128s-128-57.3-128-128V216z"/></svg>
                </button>
                <div style="background-color:#EAEAEA; width: 100%;">
                    <input id="chat-message-input" style="width:100%; background:transparent; font-size:20px; outline:none; height: 100%;border: none;" type="text" size="100"><br>
                </div>
                <div>
                    <button style="width:50px;margin:auto;padding-left:5px; height:100%; border:none;background-color:#EAEAEA;" id="chat-message-submit">
                        <svg style="width:2rem;height:2rem" stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4 mr-1" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
                    </button>
                </div>
            </div>
            <div>
                <span class="output_log"></span>
            </div>
        </div>
    </div>
</div>
{{ lang|json_script:"lang" }}
{{ chat_id|json_script:"chat-id" }}
{% endblock %}

{% block script %}
<script src="{% static 'chat/js/input.js' %}"></script>
<script src="{% static 'chat/js/ws.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.1/dist/js.cookie.min.js"></script>
{% endblock %}